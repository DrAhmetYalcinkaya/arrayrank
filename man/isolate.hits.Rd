% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/isolate.hits.R
\name{isolate.hits}
\alias{isolate.hits}
\title{Detect Significant Hits using an Isolation Forest Anomaly Pipeline}
\usage{
isolate.hits(
  data,
  sample_id_col,
  cohort_col,
  controls = NULL,
  examine = NULL,
  mad_multiplier = 2,
  sigmoid_k = 5e-04,
  anomaly_scale = 0.6,
  fold_threshold = 10,
  ntrees = 200,
  penalize = 0,
  detailed_results = FALSE
)
}
\arguments{
\item{data}{A tidy data frame with samples as rows. It must contain a sample
identifier column, a cohort column, and numeric columns for each analyte.}

\item{sample_id_col}{A character string specifying the name of the column in
\code{data} that contains the unique sample identifiers.}

\item{cohort_col}{A character string specifying the name of the column in
\code{data} that contains the group/cohort labels.}

\item{controls}{A character string specifying the label of the control group.
defaults to NULL if working without a control group.}

\item{examine}{An optional character vector specifying the non-control
group labels to be analyzed. If NULL, all groups except the control group
are analyzed.}

\item{mad_multiplier}{A numeric multiplier for the Median Absolute Deviation (MAD)
used in setting the sigmoid inflection point. Default is 2.}

\item{sigmoid_k}{A numeric value for the slope of the sigmoid curve. Default is 0.0005.}

\item{anomaly_scale}{A numeric value for the composite anomaly score threshold, used
to define the initial set of anomalies for threshold setting. Default is 0.6.}

\item{fold_threshold}{A numeric value specifying the fold change threshold for
detecting significant hits in the final classification. Default is 10.}

\item{ntrees}{A numeric value for the number of trees to build in the
isolation forest. Default is 200.}

\item{penalize}{A numeric factor used to adjust the score of hits found in the
control group. A value of 0 (default) nullifies their contribution, while a
negative value (e.g., -0.5) actively penalizes the analyte's rank score.}

\item{detailed_results}{A logical value. If FALSE (default), the function runs in
a high-performance mode and returns only a single, ranked data frame of hits.
If TRUE, it returns a full list object containing detailed, sample-level
results for every analyte.}
}
\value{
By default (\code{detailed_results = FALSE}), a single data frame of ranked
significant hits. If \code{detailed_results = TRUE}, a list containing two summary
data frames (\code{summary_hits_only}, \code{summary_all_analytes}) and detailed results
for each analyte. Both summary types will include columns for each sample's
raw value, with examine groups appearing before control groups.
}
\description{
This function takes a tidy data frame and identifies significant hits using a
two-pass anomaly detection pipeline. It is the core analysis engine designed
to work with pre-formatted data where samples are rows and analytes are columns.
}
\examples{
\dontrun{
# First, prepare data using the updated assemble.output function
all_data <- assemble.output(key = sample_key, norm_df = normalized_data)

# Run isolate.hits on the pre-tidied data frame
ranked_hits <- isolate.hits(data = all_data$tidied_analysis_set,
                            sample_id_col = "Array",
                            cohort_col = "Group",
                            controls = "Control",
                            examine = "Treatment",
                            penalize = -0.5)
}
}
